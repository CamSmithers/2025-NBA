---
title: "Exploration 2"
author: "Cam Smithers"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Necessary Packages

```{r}
library(tidyverse)
set.seed(123)
```

Necessary Data Sets

```{r}
source("/Users/camsmithers/Desktop/Camalytics/NBA/inR/Functions.R")

team_box_scores <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/team_box_scores.rds")

team_season_stats <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/team_season_stats.rds")

player_box_scores <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/full_box_player.rds")

player_regseason_stats <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/plyr_regsn_stats.rds")
```

Summary

I have been running into issues when creating models to predict the outcomes of games. The issue is my model creates predictions where I know what has already happened, I don't know what will happen in a game that has yet to be played. Therefore, I have two methods by which I can approach this problem.

1.  Determine how the team plays on average, then how they play within one and two standard deviations of the mean.
    1.  Mean: Average or Baseline for Team
    2.  1 SD: Above/Below Average Performance for Team
    3.  2 SD: Significantly Above/Below Average Performance for Team
2.  Use the data from the previous five seasons and the current season to create the models. However, when the models are created the data from the current season have more weight. Having them weigh more will enable a focus on this seasons, while providing historical context. Once the model has been created use the data from the current season to generate fitted values.

------------------------------------------------------------------------

Method 1: Using Standard Deviations to Predict Outcome

1.  For each team I want to find the mean, one sd away from the mean, and two sd away from the mean.
    -   Using Offensive Rating & Defensive Rating

```{r}
method_1 <- team_box_scores %>%
    select(gamedate, team, offrating, defrating, season) %>%
    mutate(win = if_else(offrating > defrating, 1, 0)) %>%
    group_by(season, team) %>%
    mutate(season_avg_offrtg = round(mean(offrating), 1))
```

```{r}
method_1pt2 <- method_1 %>%
    mutate(offperformance = case_when(
        offrating < season_avg_offrtg - 2 * sd(offrating) ~ "Negative Outlier",
        offrating > season_avg_offrtg + 2 * sd(offrating) ~ "Positive Outlier",
        offrating >= season_avg_offrtg - 2 * sd(offrating) &
            offrating < season_avg_offrtg - sd(offrating) ~ "Within -2SD",
        offrating > season_avg_offrtg + sd(offrating) & 
            offrating <= season_avg_offrtg + 2 * sd(offrating) ~ "Within +2SD",
        offrating >= season_avg_offrtg - sd(offrating) &
            offrating < season_avg_offrtg ~ "Within -1SD",
        offrating >= season_avg_offrtg &
            offrating < offrating + sd(offrating) ~ "Within +1SD"
    ))
```

```{r}
summary_count <- method_1pt2 %>%
    group_by(season, team, offperformance) %>%
    summarize(offperformance_count = n())
```

```{r}
summary_count_2 <- summary_count %>%
    group_by(season, team) %>%
    arrange(desc(offperformance_count))
```

```{r}
test_summary <- method_1pt2 %>%
    group_by(offperformance) %>%
    filter(team == "PHI", season == 2022) %>%
    summarise(offperformance_count = n()) %>%
    arrange(desc(offperformance_count)) %>%
    slice_head(n = 1) %>%
    mutate(team = "PHI", season = 2022)
```

```{r}

```

```{r}
nba_df <- data.frame(matrix(ncol = 4, nrow = 0))
names(blank_df) <- c("offperformance_type", "performance_count", "team", "season")

nba_teams <- unique(method_1pt2$team)
nba_years <- unique(method_1pt2$season)
nba_list <- vector(mode = "list", length = 0)

for (nba_year in nba_years) {
    for (nba_team in nba_teams) {
        offense_performance_sort <- method_1pt2 %>%
            group_by(offperformance) %>%
            filter(team == nba_team, season == nba_year) %>%
            summarize(offperformance_count = n()) %>%
            arrange(desc(offperformance_count)) %>%
            slice_head(n = 1) %>%
            mutate(team = nba_team, season = nba_year)
        
        nba_df <- rbind(nba_df, offense_performance_sort)
    }
}
```

```{r}
nba_testing_frame <- data.frame(nba_list)
```


Next Group By Team & Season -\> Count Offensive Performance Type
