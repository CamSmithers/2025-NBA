---
title: "Exploration 2"
author: "Cam Smithers"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Necessary Packages

```{r}
library(tidyverse)
set.seed(123)
```

Necessary Data Sets

```{r}
source("/Users/camsmithers/Desktop/Camalytics/NBA/inR/Functions.R")

team_box_scores <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/team_box_scores.rds")

team_season_stats <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/team_season_stats.rds")

player_box_scores <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/full_box_player.rds")

player_regseason_stats <- readRDS(
    "/Users/camsmithers/Desktop/Camalytics/NBA/Data-NBA/plyr_regsn_stats.rds")
```

Summary

I have been running into issues when creating models to predict the outcomes of games. The issue is my model creates predictions where I know what has already happened, I don't know what will happen in a game that has yet to be played. Therefore, I have two methods by which I can approach this problem.

1.  Determine how the team plays on average, then how they play within one and two standard deviations of the mean.
    1.  Mean: Average or Baseline for Team
    2.  1 SD: Above/Below Average Performance for Team
    3.  2 SD: Significantly Above/Below Average Performance for Team
2.  Use the data from the previous five seasons and the current season to create the models. However, when the models are created the data from the current season have more weight. Having them weigh more will enable a focus on this seasons, while providing historical context. Once the model has been created use the data from the current season to generate fitted values.

------------------------------------------------------------------------

Method 1: Using Standard Deviations to Predict Outcome

Statistics I May Want

-   Offensive Rating

-   Defensive Rating

-   Possessions

-   Points per Possession

```{r}
usdpo <- team_box_scores %>%
    select(gamedate, team, season, offrating, defrating, pts) %>%
    mutate(
        win = if_else(offrating > defrating, 1, 0),
        netrating = offrating - defrating,
        poss = trunc((100 *pts) / offrating),
        ptsperposs = round(pts/poss, 2)) %>%
    group_by(season) %>%
    mutate(
        ls_avg_offrating = mean(offrating),
        ls_avg_defrating = mean(defrating),
        ls_avg_ptsperposs = mean(ptsperposs),
        ls_sd_offrating = sd(offrating),
        ls_sd_defrating = sd(defrating),
        ls_sd_ptsperposs = sd(ptsperposs)) %>%
    ungroup() %>%
    group_by(season, team) %>%
    mutate(ts_avg_netrating = mean(netrating)) %>%
    ungroup()
```

```{r}
withoffparm <- std_dev_mag(dirty_data =  usdpo,
                           new_colname = offpfmc,
                           og_value = usdpo$offrating,
                           avg_value = usdpo$ls_avg_offrating,
                           sd_value = usdpo$ls_sd_offrating)
```

```{r}
#Offensive
off_nba_df <- data.frame(matrix(ncol = 4, nrow = 0))
names(off_nba_df) <- c("sop_type", "sp_count", "team", "season")

nba_teams <- unique(usdpo_2$team)
nba_years <- unique(usdpo_2$season)

for (nba_year in nba_years) {
    for (nba_team in nba_teams) {
        offense_performance_sort <- usdpo_2 %>%
            group_by(offperformance) %>%
            filter(team == nba_team, season == nba_year) %>%
            summarize(offperformance_count = n()) %>%
            arrange(desc(offperformance_count)) %>%
            slice_head(n = 1) %>%
            mutate(team = nba_team, season = nba_year)
        
        off_nba_df <- rbind(off_nba_df, offense_performance_sort)
    }
}

#Defensive
def_nba_df <- data.frame(matrix(ncol = 4, nrow = 0))
names(def_nba_df) <- c("sdp_type", "sdp_count", "team", "season")

for (nba_year in nba_years) {
    for (nba_team in nba_teams) {
        defense_performance_sort <- usdpo_2 %>%
            group_by(defperformance) %>%
            filter(team == nba_team, season == nba_year) %>%
            summarize(defperformance_count = n()) %>%
            arrange(desc(defperformance_count)) %>%
            slice_head(n = 1) %>%
            mutate(team = nba_team, season = nba_year)
        
        def_nba_df <- rbind(def_nba_df, defense_performance_sort)
    }
}

#Posessions
poss_nba_df <- data.frame(matrix(ncol = 4, nrow = 0))
names(poss_nba_df) <- c()
```

```{r}
names(nba_df) <- c("sop_type", "sop_count", "team", "season")
nba_df <- nba_df %>%
    mutate(sop_ranking = case_when(
        sop_type == ""
    ))
```

Next Group By Team & Season -\> Count Offensive Performance Type
